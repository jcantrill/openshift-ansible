---
- shell: >
    echo "{{fluentd_nodeselector}}" | cut -d':' -f1
  register: fluentd_nodeselector_key

- shell: >
    echo "{{fluentd_nodeselector}}" | cut -d' ' -f2
  register: fluentd_nodeselector_value

- shell: >
    {{openshift.common.client_binary}} --config={{mktemp.stdout}}/admin.kubeconfig get node -o name | sed "s,^node/,,g"
  register: fluentd_hosts
  when: "'--all' in fluentd_hosts"

- name: start fluentd
  include: label_node.yaml
  vars:
    host: "{{fluentd_host}}"
    label: "{{fluentd_nodeselector_key.stdout}}"
    value: "{{fluentd_nodeselector_value.stdout}}"
  with_items: "{{fluentd_hosts.stdout}}"
  loop_control:
    loop_var: fluentd_host

- shell: >
    {{openshift.common.client_binary}} --config={{mktemp.stdout}}/admin.kubeconfig get dc -l component=es -o name -n {{logging_namespace}}
  register: es_dc

- name: start elasticsearch
  include: scale.yaml
  vars:
    desired: 1
  with_items: "{{es_dc.stdout}}"
  loop_control:
    loop_var: object

- shell: >
    {{openshift.common.client_binary}} --config={{mktemp.stdout}}/admin.kubeconfig get dc -l component=kibana -o name -n {{logging_namespace}}
  register: kibana_dc

- name: start kibana
  include: scale.yaml
  vars:
    desired: 1
  with_items: "{{kibana_dc.stdout}}"
  loop_control:
    loop_var: object

- shell: >
    {{openshift.common.client_binary}} --config={{mktemp.stdout}}/admin.kubeconfig get dc -l component=curator -o name -n {{logging_namespace}}
  register: curator_dc

- name: start curator
  include: scale.yaml
  vars:
    desired: 1
  with_items: "{{curator_dc.stdout}}"
  loop_control:
    loop_var: object

- shell: >
    {{openshift.common.client_binary}} --config={{mktemp.stdout}}/admin.kubeconfig get dc -l component=es-ops -o name -n {{logging_namespace}}
  register: es_dc

- name: start elasticsearch-ops
  include: scale.yaml
  vars:
    desired: 1
  with_items: "{{es_dc.stdout}}"
  loop_control:
    loop_var: object
  when: logging_use_ops

- shell: >
    {{openshift.common.client_binary}} --config={{mktemp.stdout}}/admin.kubeconfig get dc -l component=kibana-ops -o name -n {{logging_namespace}}
  register: kibana_dc

- name: start kibana-ops
  include: scale.yaml
  vars:
    desired: 1
  with_items: "{{kibana_dc.stdout}}"
  loop_control:
    loop_var: object
  when: logging_use_ops

- shell: >
    {{openshift.common.client_binary}} --config={{mktemp.stdout}}/admin.kubeconfig get dc -l component=curator-ops -o name -n {{logging_namespace}}
  register: curator_dc

- name: start curator-ops
  include: scale.yaml
  vars:
    desired: 1
  with_items: "{{curator_dc.stdout}}"
  loop_control:
    loop_var: object
  when: logging_use_ops
